jQuery(document).ready(function(g){function n(e,t){if("function"==typeof moment){var a=["#C62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F","#212121"],n=["#EF9A9A","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5"];this.conf={locale:t.locale?t.locale:"fr",view:"week",enableKeyboard:!t.enableKeyboard||t.enableKeyboard,defaultView:{largeScreen:t.defaultView&&t.defaultView.largeScreen?t.defaultView.largeScreen:"week",smallScreen:t.defaultView&&t.defaultView.smallScreen?t.defaultView.smallScreen:"day",smallScreenThreshold:t.defaultView&&t.defaultView.smallScreenThreshold?t.defaultView.smallScreenThreshold:1e3},weekday:{timeline:{fromHour:t.weekday&&t.weekday.timeline&&t.weekday.timeline.fromHour?t.weekday.timeline.fromHour:7,toHour:t.weekday&&t.weekday.timeline&&t.weekday.timeline.toHour?t.weekday.timeline.toHour:20,intervalMinutes:t.weekday&&t.weekday.timeline&&t.weekday.timeline.intervalMinutes?t.weekday.timeline.intervalMinutes:60,format:t.weekday&&t.weekday.timeline&&t.weekday.timeline.format?t.weekday.timeline.format:"HH:mm",heightPx:t.weekday&&t.weekday.timeline&&t.weekday.timeline.heightPx?t.weekday.timeline.heightPx:50,autoResize:!t.weekday||(!t.weekday.timeline||(void 0===t.weekday.timeline.autoResize||t.weekday.timeline.autoResize))},dayline:{weekdays:t.weekday&&t.weekday.dayline&&t.weekday.dayline.weekdays?t.weekday.dayline.weekdays:[0,1,2,3,4,5,6],format:t.weekday&&t.weekday.dayline&&t.weekday.dayline.format?t.weekday.dayline.format:"dddd DD/MM",heightPx:t.weekday&&t.weekday.dayline&&t.weekday.dayline.heightPx&&t.weekday.dayline.heightPx&&31<t.weekday.dayline.heightPx?t.weekday.dayline.heightPx:31,month:{format:t.weekday&&t.weekday.dayline&&t.weekday.dayline.month&&t.weekday.dayline.month.format?t.weekday.dayline.month.format:"MMMM YYYY",heightPx:t.weekday&&t.weekday.dayline&&t.weekday.dayline.month&&t.weekday.dayline.month.heightPx?t.weekday.dayline.month.heightPx:30,weekFormat:t.weekday&&t.weekday.dayline&&t.weekday.dayline.month&&t.weekday.dayline.month.weekFormat?t.weekday.dayline.month.weekFormat:"w"}}},month:{format:t.month&&t.month.format?t.month.format:"MMMM YYYY",heightPx:t.month&&t.month.heightPx&&31<t.month.heightPx?t.month.heightPx:31,weekline:{format:t.month&&t.month.weekline&&t.month.weekline.format?t.month.weekline.format:"w",heightPx:t.month&&t.month.weekline&&t.month.weekline.heightPx?t.month.weekline.heightPx:80},dayheader:{weekdays:t.month&&t.month.dayheader&&t.month.dayheader.weekdays?t.month.dayheader.weekdays:[0,1,2,3,4,5,6],format:t.month&&t.month.dayheader&&t.month.dayheader.format?t.month.dayheader.format:"dddd",heightPx:t.month&&t.month.dayheader&&t.month.dayheader.heightPx?t.month.dayheader.heightPx:30},day:{format:t.month&&t.month.day&&t.month.day.format?t.month.day.format:"DD/MM"}},unixTimestamp:t.unixTimestamp?t.unixTimestamp:moment().format("X"),event:{hover:{delay:t.event&&t.event.hover&&t.event.hover.delay?t.event.hover.delay:500}},colors:{events:t.colors&&t.colors.events?t.colors.events:a,daynotes:t.colors&&t.colors.daynotes?t.colors.daynotes:n,random:!t.colors||(!t.colors.random||t.colors.random)},categories:{enable:!t.categories||(void 0===t.categories.enable||t.categories.enable),hover:{delay:t.categories&&t.categories.hover&&t.categories.hover.delay?t.categories.hover.delay:500}},now:{enable:!!t.now&&(void 0!==t.now.enable&&t.now.enable),refresh:!!t.now&&(void 0!==t.now.refresh&&t.now.refresh),heightPx:t.now&&t.now.heightPx?t.now.heightPx:1,style:t.now&&t.now.style?t.now.style:"solid",color:t.now&&t.now.color?t.now.color:"#03A9F4"}},moment.locale(this.conf.locale),this.setEventColors(this.conf.colors.events),this.setDaynoteColors(this.conf.colors.daynotes),this.eventCategoryColor=[],this.daynoteCategoryColor=[],this.userEventCategoryColor=[],this.userDaynoteCategoryColor=[],this.setEvents(t.events?t.events:[]),this.setDaynotes(t.daynotes?t.daynotes:[]),"mobile"==this.mobileQuery()?this.setView(this.conf.defaultView.smallScreen):this.setView(this.conf.defaultView.largeScreen),this.element=e,this.initTime=!1}else console.error("Calendar require Moment.js !")}n.prototype.init=function(){var e=Date.now();this.element.addClass("loading"),this.calculateCurrentInterval(),g(this.element).trigger("Calendar.init",[this,this.getPrevViewInterval(),this.getViewInterval(),this.getNextViewInterval()]),g(this.element).html(""),g(this.element).hasClass("calendar")||g(this.element).addClass("calendar"),"day"!=this.getView()&&"week"!=this.getView()||this.conf.weekday.timeline.autoResize&&this.resizeTimeline(),this.drawCategories(),"day"!=this.getView()&&"week"!=this.getView()||(this.weekDrawTime(),this.weekDrawDays(),this.weekDrawDaynotes(),this.weekDrawEvents()),"month"==this.getView()&&(this.monthDrawWeek(),this.monthDrawWeekNumbers(),this.monthDrawWeekDays(),this.monthDrawDaynotes(),this.monthDrawEvents()),this.drawModal(),this.drawNow(),this.positionEvents(),this.hoverEventOrDaynote(),this.clickEventOrDaynote(),this.addBtnLeftRight(),this.clickSwitchView(),this.keyboardSwitchView(),this.defaultEvents(),this.element.removeClass("loading"),this.initTime=Date.now()-e+"ms"},n.prototype.defaultEvents=function(){if(1!=this.binded){var e=this,t=function(e,t,a){if(!e.isDefaultPrevented()){if(parseInt(a.css("top"))>=a.closest("ul").height()/2-t.conf.weekday.timeline.heightPx){var n=parseInt(a.css("top"))+parseInt(a.css("height"));a.css("z-index",10).animate({height:n,top:0,width:"100%",left:0},50)}else{n=a.closest("ul").height()-parseInt(a.css("top"));a.css("z-index",10).animate({height:n,width:"100%",left:0},50)}a.find(".event-name").removeClass("invisible"),a.find(".event-content").removeClass("invisible")}};g(e.element).off("Calendar.event-mouseenter",t).on("Calendar.event-mouseenter",t),g(e.element).off("Calendar.daynote-mouseenter",t).on("Calendar.daynote-mouseenter",t);var a=function(e,t,a){e.isDefaultPrevented()||(a.css("z-index","auto").animate({height:parseFloat(a.attr("data-height"))+"px",top:parseFloat(a.attr("data-top")),width:parseFloat(a.attr("data-width"))+"%",left:parseFloat(a.attr("data-left"))+"%"},50),a.find(".event-content").addClass("invisible"))};g(e.element).off("Calendar.event-mouseleave",a).on("Calendar.event-mouseleave",a),g(e.element).off("Calendar.daynote-mouseleave",a).on("Calendar.daynote-mouseleave",a);var n=function(e,t,a,n){if(!e.isDefaultPrevented()){var o=g(t.element).find("#calendar-modal"),i=t.hexToRgb(a.attr("data-color"));o.css("background","rgba("+i.r+", "+i.g+", "+i.b+", 0.5)"),o.find(".modal-title").append(a.attr("data-title")+" "),o.find(".modal-body").append(g("<h4>").append(g(this).closest(".calendar-events-day").find("span").html()).append(" ").append(g("<small>").text(a.find(".event-date").text()))),o.find(".modal-body").append(a.find(".event-content").html()),o.modal("show"),o.on("hidden.bs.modal",function(e){g(e.target).find(".modal-title").html(""),g(e.target).find(".modal-body").html("")})}};g(e.element).off("Calendar.event-click",n).on("Calendar.event-click",n),g(e.element).off("Calendar.daynote-click",n).on("Calendar.daynote-click",n);var o=function(e,t,a){if(!e.isDefaultPrevented()){var n=t.element.find('.calendar-event[data-category="'+g(a).text()+'"]');"false"==g(a).attr("data-clicked")&&n.animate({opacity:0},200,function(){n.css("display","none"),g(a).css("background-color","#E0E0E0"),g(a).attr("data-clicked",!0)}),"true"==g(a).attr("data-clicked")&&(n.css("display","list-item"),g(a).css("background-color",g(a).attr("data-color")),n.animate({opacity:1},200,function(){g(a).attr("data-clicked",!1)}))}};g(e.element).off("Calendar.category-event-click",o).on("Calendar.category-event-click",o),g(e.element).off("Calendar.category-daynote-click",o).on("Calendar.category-daynote-click",o);var i=function(e,t,a){e.isDefaultPrevented()||t.element.find(".calendar-event").each(function(e,t){g(t).attr("data-category")!=a.text()&&g(t).css("opacity",.2)})};g(e.element).off("Calendar.category-event-mouseenter",i).on("Calendar.category-event-mouseenter",i),g(e.element).off("Calendar.category-daynote-mouseenter",i).on("Calendar.category-daynote-mouseenter",i);var r=function(e,t,a){e.isDefaultPrevented()||t.element.find(".calendar-event").each(function(e,t){g(t).css("opacity",1)})};g(e.element).off("Calendar.category-event-mouseleave",r).on("Calendar.category-event-mouseleave",r),g(e.element).off("Calendar.category-daynote-mouseleave",r).on("Calendar.category-daynote-mouseleave",r),this.binded=!0}},n.prototype.weekDrawTime=function(){g(this.element).append(g("<div>",{class:"calendar-timeline"})),g(this.element).find("div.calendar-timeline").css("padding-top",this.conf.weekday.dayline.heightPx+"px");var e=this.conf.weekday.dayline.month.heightPx;if(this.conf.categories.enable){var t=g(this.element).find("div.calendar-categories");e+=t.height()+parseFloat(t.css("margin-bottom"))}g(this.element).find("div.calendar-timeline").css("margin-top",e+"px"),g(this.element).find("div.calendar-timeline").append(g("<ul>"));var a,n=g(this.element).find("div.calendar-timeline").find("ul"),o=moment(moment()).startOf("Week");o.add(this.conf.weekday.timeline.fromHour,"H");for(var i=(60*(parseInt(this.conf.weekday.timeline.toHour)+1)-60*parseInt(this.conf.weekday.timeline.fromHour))/this.conf.weekday.timeline.intervalMinutes,r=0;r<i;)(a=g("<li>")).append(g("<span>").text(o.format(this.conf.weekday.timeline.format))),a.height(this.conf.weekday.timeline.heightPx),n.append(a),o.add(this.conf.weekday.timeline.intervalMinutes,"m"),r++},n.prototype.weekDrawDays=function(){g(this.element).append(g("<div>",{class:"calendar-events"}));var e=g("<div>",{class:"calendar-month"}).css("height",this.conf.weekday.dayline.month.heightPx+"px").css("text-align","center").css("padding-top",(this.conf.weekday.dayline.month.heightPx-20)/2+"px");"week"===this.getView()&&e.text(this.miscUcfirstString(moment.unix(this.conf.unixTimestamp).format(this.conf.weekday.dayline.month.format))),"day"===this.getView()&&(e.text(this.miscUcfirstString(moment.unix(this.conf.unixTimestamp).format(this.conf.weekday.dayline.month.weekFormat))),e.addClass("daytoweek")),g(this.element).find("div.calendar-events").append(e),g(this.element).find("div.calendar-events").append(g("<ul>"));for(var t,a=g(this.element).find("div.calendar-events").find("ul"),n=this.getViewDays(),o=0;o<n.length;o++)time=moment.unix(n[o]),(t=g("<li>",{class:"calendar-events-day"})).css("width",100/n.length+"%"),(e=g("<div>",{class:"calendar-day-header"})).height(this.conf.weekday.dayline.heightPx),e.append(g("<span>").addClass("weektoday").css("width","100%").html(this.miscUcfirstString(time.format(this.conf.weekday.dayline.format)))),t.append(e),t.attr("data-time",time.startOf("day").format("X")),t.append(g("<ul>")),t.find("ul").height(60/this.conf.weekday.timeline.intervalMinutes*(this.conf.weekday.timeline.toHour-this.conf.weekday.timeline.fromHour)*this.conf.weekday.timeline.heightPx+60/this.conf.weekday.timeline.intervalMinutes*this.conf.weekday.timeline.heightPx),a.append(t);var i=0;g(this.element).find(".calendar-day-header").each(function(){g(this).height()>i&&(i=g(this).height())}),g(this.element).find(".calendar-day-header").each(function(){g(this).height(i)}),this.conf.weekday.dayline.heightPx<i&&(this.conf.weekday.dayline.heightPx=i,g(this.element).find("div.calendar-timeline").css("padding-top",this.conf.weekday.dayline.heightPx+"px"))},n.prototype.drawCategories=function(){if(this.determineEventsCategories(),this.determineDaynotesCategories(),this.conf.categories.enable){for(var e,t=g("<div>",{class:"calendar-categories"}).css("height","26px"),a=0;a<this.eventCategoryColor.length;a++)(e=g("<span>",{class:"badge badge-default calendar-label"})).css("margin-right","5px"),e.css("background-color",this.eventCategoryColor[a].color),e.css("cursor","pointer"),e.attr("data-color",this.eventCategoryColor[a].color),e.attr("data-clicked",!1),e.text(this.eventCategoryColor[a].category),t.append(e);for(a=0;a<this.daynoteCategoryColor.length;a++)(e=g("<span>",{class:"badge badge-default calendar-label calendar-label-daynote"})).css("margin-right","5px"),e.css("background-color",this.daynoteCategoryColor[a].color),e.css("cursor","pointer"),e.attr("data-color",this.daynoteCategoryColor[a].color),e.attr("data-clicked",!1),e.text(this.daynoteCategoryColor[a].category),t.append(e);this.element.prepend(t),this.hoverCategory(),this.clickCategory()}},n.prototype.hoverCategory=function(){var e,t,a=this;this.element.find(".calendar-label").hover(function(){t=g(this),e=setTimeout(function(){t.hasClass("calendar-label-daynote")?g(a.element).trigger("Calendar.category-daynote-mouseenter",[a,t]):g(a.element).trigger("Calendar.category-event-mouseenter",[a,t])},a.conf.categories.hover.delay)},function(){clearTimeout(e),(t=g(this)).hasClass("calendar-label-daynote")?g(a.element).trigger("Calendar.category-daynote-mouseleave",[a,t]):g(a.element).trigger("Calendar.category-event-mouseleave",[a,t])})},n.prototype.clickCategory=function(){var t=this;this.element.find(".calendar-label").click(function(e){g(e.target).hasClass("calendar-label-daynote")?g(t.element).trigger("Calendar.category-daynote-click",[t,void 0]):g(t.element).trigger("Calendar.category-event-click",[t,void 0])})},n.prototype.positionEvents=function(){switch(this.getView()){case"day":case"week":this.positionEventsInWeek();break;case"month":this.positionEventsInMonth()}},n.prototype.positionEventsInWeek=function(){var u=this,v=0;this.element.find(".calendar-event").each(function(e){var t=parseInt(g(this).attr("data-start")),a=parseInt(g(this).attr("data-end"))-t,n=parseInt(g(this).closest("li.calendar-events-day").attr("data-time"))+60*u.conf.weekday.timeline.fromHour*60;v<n&&(v=n);var o=(t-n)/60/u.conf.weekday.timeline.intervalMinutes*u.conf.weekday.timeline.heightPx-1,i=a/60/u.conf.weekday.timeline.intervalMinutes*u.conf.weekday.timeline.heightPx+1,r=!1,s=[],d=g(this);g(this).closest("ul").find("li.calendar-event").each(function(e,t){g(t)[0]!=d[0]&&(parseInt(d.attr("data-start"))<parseInt(g(t).attr("data-end"))&&parseInt(d.attr("data-end"))>parseInt(g(t).attr("data-start"))&&(s.push(g(t)),0),parseInt(d.attr("data-start"))<parseInt(g(t).attr("data-end"))&&parseInt(d.attr("data-end"))>parseInt(g(t).attr("data-end"))?0:parseInt(d.attr("data-start"))==parseInt(g(t).attr("data-start"))&&parseInt(g(t).attr("data-index"))<parseInt(d.attr("data-index"))&&0)});var l=[];l.push(parseInt(d.attr("data-start"))),l.push(parseInt(d.attr("data-end")));for(e=0;e<s.length;e++)parseInt(s[e].attr("data-start"))>=parseInt(d.attr("data-start"))&&parseInt(s[e].attr("data-start"))<=parseInt(d.attr("data-end"))&&l.push(parseInt(s[e].attr("data-start"))),parseInt(s[e].attr("data-end"))>=parseInt(d.attr("data-start"))&&parseInt(s[e].attr("data-end"))<=parseInt(d.attr("data-end"))&&l.push(parseInt(s[e].attr("data-end")));(l=u.miscUniqueArray(l)).sort(function(e,t){return t<e?1:-1});for(e=0;e<l.length;e++){for(var h=0,m=0;m<s.length;m++)l[e]>parseInt(s[m].attr("data-start"))&&l[e]<=parseInt(s[m].attr("data-end"))&&h++;(0<h&&r<h||!1===r)&&(r=h)}for(d.attr("data-events",r+1),d.attr("data-divider",r+1),e=s.length;e--;)parseInt(s[e].attr("data-divider"))>parseInt(d.attr("data-divider"))&&d.attr("data-divider",s[e].attr("data-divider"));var c=[];for(e=0;e<parseInt(d.attr("data-divider"));e++){c[e]=!1;for(m=0;m<s.length;m++)for(var f=0;f<String(s[m].attr("data-positions")).split(",").length;f++){String(s[m].attr("data-positions")).split(",")[f]==e&&(c[e]=!0)}}for(d.attr("data-positions",-1),e=0;-1==parseInt(d.attr("data-positions"));){if(!1===c[e]&&(d.attr("data-positions",e),1<parseInt(d.attr("data-divider"))-parseInt(d.attr("data-events"))+1))for(;!1===c[e+1];)d.attr("data-positions",d.attr("data-positions")+","+(e+1)),e++;e++}var y=100/(parseInt(d.attr("data-divider"))/String(d.attr("data-positions")).split(",").length),p=String(d.attr("data-positions")).split(",")[0]/parseInt(d.attr("data-divider"))*100;u.setEventPosition(this,o,i,p,y)})},n.prototype.positionEventsInMonth=function(){var r=this;this.element.find("li.calendar-month-events-day").each(function(){var i=g(this).find(".calendar-event").length;g(this).find(".calendar-event").each(function(e){var t=parseInt(g(this).closest(".calendar-month-events-day").index())*r.conf.month.weekline.heightPx+20-1,a=r.conf.month.weekline.heightPx-21+1,n=100/i,o=100/i*e;r.setEventPosition(this,t,a,o,n)})})},n.prototype.setEventPosition=function(e,t,a,n,o){g(e).attr("data-top",t),g(e).attr("data-height",a),g(e).attr("data-left",n),g(e).attr("data-width",o),g(e).css({top:t+"px",height:a+"px",left:n+"%",width:o+"%"})},n.prototype.weekDrawEvents=function(){var a,e,n,o,i,r,t=this.events.length;for(e=0;e<t;e++)if(a=this.events[e],n=!1,o=this.conf.weekday.timeline.fromHour,i=this.conf.weekday.timeline.toHour,r=this.conf.weekday.timeline.intervalMinutes,g(this.element).find(".calendar-events-day").each(function(e,t){a.start>=parseInt(g(t).attr("data-time"))+60*o*60&&a.end<=parseInt(g(t).attr("data-time"))+60*i*60+60/r*r*60&&(n=t)}),!1===n){if(a.start>a.end)return void console.warn("incorrect time day events ends before start");for(var s=moment.unix(a.end).format("DD")-moment.unix(a.start).format("DD"),d=0;d<=s;d++){var l=JSON.parse(JSON.stringify(a));0===d&&(l.end=moment.unix(l.start).endOf("day").format("X")),0!==d&&d!==s&&(l.start=moment.unix(l.start).startOf("day").format("X"),l.end=moment.unix(l.end).endOf("day").format("X")),d===s&&(l.start=moment.unix(l.end).startOf("day").format("X")),g(this.element).find(".calendar-events-day").each(function(e,t){l.start>=parseInt(g(t).attr("data-time"))+60*o*60&&l.end<=parseInt(g(t).attr("data-time"))+60*i*60+60/r*r*60&&(n=t)}),this.drawEventsOrDaynotes(n,e,moment.unix(l.start).format("X"),moment.unix(l.end).format("X"),l.title,l.content,l.category,this.getEventCategoryColor(l.category),moment.unix(a.start).format("DD MM YYYY HH:mm:ss")+" - "+moment.unix(a.end).format("DD MM YYYY HH:mm:ss"),["calendar-event"])}console.warn("Event "+e+" out of current view")}else this.drawEventsOrDaynotes(n,e,moment.unix(a.start).format("X"),moment.unix(a.end).format("X"),a.title,a.content,a.category,this.getEventCategoryColor(a.category),moment.unix(a.start).format(this.conf.weekday.timeline.format)+" - "+moment.unix(a.end).format(this.conf.weekday.timeline.format),["calendar-event"])},n.prototype.weekDrawDaynotes=function(){var e,a,n,t=this.daynotes.length;for(e=0;e<t;e++)if(a=this.daynotes[e],n=!1,g(this.element).find(".calendar-events-day").each(function(e,t){parseInt(moment.unix(a.time).startOf("day").format("X"))==parseInt(g(t).attr("data-time"))&&(n=t)}),!1===n);else{this.getDaynoteCategoryColor(a.category);var o=this.conf.weekday.timeline.fromHour,i=this.conf.weekday.timeline.toHour+parseInt(this.conf.weekday.timeline.intervalMinutes/60),r=60*(this.conf.weekday.timeline.intervalMinutes/60-parseInt(this.conf.weekday.timeline.intervalMinutes/60));this.drawEventsOrDaynotes(n,e,moment.unix(a.time).startOf("day").add(o,"h").format("X"),moment.unix(a.time).startOf("day").add(i,"h").add(r,"m").format("X"),a.title,a.content,a.category,this.getDaynoteCategoryColor(a.category),"",["calendar-event","calendar-daynote"])}},n.prototype.drawEventsOrDaynotes=function(e,t,n,o,i,r,s,d,l,h){for(var m=g("<li>"),c=h.length;c--;)m.addClass(h[c]);m.attr("data-index",t),m.attr("data-start",n),m.attr("data-end",o),m.attr("data-title",i),m.attr("data-content",r),m.attr("data-category",s),m.attr("data-color",d),m.css("background",d),a=g("<a>",{href:"#"}),a.append(g("<em>",{class:"event-name"}).text(i)),a.append(g("<em>",{class:"event-content invisible"})),a.find(".event-content").append(g("<b>",{class:"event-date"}).html(l)),a.find(".event-content").append(g("<br>")),a.find(".event-content").append(r),m.append(a),g(e).find("ul").append(m)},n.prototype.monthDrawEvents=function(){var e,a,n,t=this.events.length;for(e=0;e<t;e++)a=this.events[e],n=!1,g(this.element).find(".calendar-month-events-day").each(function(e,t){a.start>=parseInt(g(t).attr("data-time-from"))&&a.end<=parseInt(g(t).attr("data-time-to"))&&(n=t)}),!1===n||this.drawEventsOrDaynotes(n,e,moment.unix(a.start).format("X"),moment.unix(a.end).format("X"),a.title,a.content,a.category,this.getEventCategoryColor(a.category),moment.unix(a.start).format(this.conf.month.day.format)+" : "+moment.unix(a.start).format(this.conf.weekday.timeline.format)+" - "+moment.unix(a.end).format(this.conf.weekday.timeline.format),["calendar-event"])},n.prototype.monthDrawDaynotes=function(){var e,a,n,t=this.daynotes.length;for(e=0;e<t;e++)a=this.daynotes[e],n=!1,g(this.element).find(".calendar-month-events-day").each(function(e,t){a.time>=parseInt(g(t).attr("data-time-from"))&&a.time<=parseInt(g(t).attr("data-time-to"))&&(n=t)}),!1===n||this.drawEventsOrDaynotes(n,e,moment.unix(a.time).startOf("day").format("X"),moment.unix(a.time).endOf("day").format("X"),a.title,a.content,a.category,this.getDaynoteCategoryColor(a.category),moment.unix(a.time).format(this.conf.month.day.format),["calendar-event","calendar-daynote"])},n.prototype.drawModal=function(){g(this.element).append('<div class="modal fade" id="calendar-modal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h3 class="modal-title"></h3><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"></div></div></div></div>')},n.prototype.drawNow=function(){if(this.conf.now.enable){var e=g("<hr>",{class:"featurette-divider calendar-now"});e.css("width","100%"),e.css("position","absolute"),e.css("z-index",3),e.css("border-top",this.conf.now.heightPx+"px "+this.conf.now.style+" "+this.conf.now.color);var t=(moment().format("X")-moment().startOf("day").add(this.conf.weekday.timeline.fromHour,"h").format("X"))/60/this.conf.weekday.timeline.intervalMinutes*this.conf.weekday.timeline.heightPx-this.conf.weekday.timeline.heightPx/2;if(e.css("top",t+"px"),this.element.find('li.calendar-events-day[data-time="'+moment().startOf("day").format("X")+'"]').find("ul").append(e),this.conf.now.refresh){var a=this;setInterval(function(){var e=a.element.find("hr.calendar-now").remove();(e=g("<hr>",{class:"featurette-divider calendar-now"})).css("width","100%"),e.css("position","absolute"),e.css("z-index",2),e.css("border-top",a.conf.now.heightPx+"px "+a.conf.now.style+" "+a.conf.now.color);var t=(moment().format("X")-moment().startOf("day").add(a.conf.weekday.timeline.fromHour,"h").format("X"))/60/a.conf.weekday.timeline.intervalMinutes*a.conf.weekday.timeline.heightPx-a.conf.weekday.timeline.heightPx/2;e.css("top",t+"px"),a.element.find('li.calendar-events-day[data-time="'+moment().startOf("day").format("X")+'"]').find("ul").append(e)},1e4)}}},n.prototype.hoverEventOrDaynote=function(){var t=this;this.element.find(".calendar-event").each(function(){var e;g(this).hover(function(){elem=g(this),e=setTimeout(function(){elem.hasClass("calendar-daynote")?g(t.element).trigger("Calendar.daynote-mouseenter",[t,elem]):g(t.element).trigger("Calendar.event-mouseenter",[t,elem])},t.conf.event.hover.delay)},function(){clearTimeout(e),elem=g(this),elem.hasClass("calendar-daynote")?g(t.element).trigger("Calendar.daynote-mouseleave",[t,elem]):g(t.element).trigger("Calendar.event-mouseleave",[t,elem])})})},n.prototype.clickEventOrDaynote=function(){var t=this;this.element.find(".calendar-event").each(function(){g(this).click(function(e){elem=g(e.target),"LI"===elem.prop("nodeName")||elem.hasClass("calendar-event")||(elem=elem.closest("li.calendar-event")),elem.hasClass("calendar-daynote")?g(t.element).trigger("Calendar.daynote-click",[t,elem,t.daynotes[parseInt(elem.attr("data-index"))]]):g(t.element).trigger("Calendar.event-click",[t,elem,t.events[parseInt(elem.attr("data-index"))]])})})},n.prototype.resizeTimeline=function(){for(var e=this.events.length;e--;)parseInt(moment.unix(this.events[e].start).format("HH"))<this.conf.weekday.timeline.fromHour&&(this.conf.weekday.timeline.fromHour=parseInt(moment.unix(this.events[e].start).format("HH"))),parseInt(this.events[e].end)>parseInt(moment.unix(this.events[e].end).startOf("day").add(this.conf.weekday.timeline.toHour,"hour").format("X"))&&(this.conf.weekday.timeline.toHour=parseInt(moment.unix(this.events[e].end).hour()),this.conf.weekday.timeline.toHour<23&&this.conf.weekday.timeline.toHour++)},n.prototype.getViewDays=function(){var e,t=[];if("day"===this.getView()&&t.push(parseInt(moment.unix(this.conf.unixTimestamp).format("X"))),"week"===this.getView())for(e=0;e<this.conf.weekday.dayline.weekdays.length;e++)t.push(parseInt(moment.unix(this.conf.unixTimestamp).startOf("week").add(this.conf.weekday.dayline.weekdays[e],"days").format("X")));if("month"===this.getView()){var a=moment.unix(this.conf.unixTimestamp).daysInMonth(),n=moment.unix(this.conf.unixTimestamp).startOf("month");for(e=0;e<a;e++)t.push(parseInt(n.startOf("day").format("X"))),n.add(1,"days")}return t},n.prototype.addBtnLeftRight=function(){var a=this;this.element.find(".btn-move-calendar").click(function(e){var t=g(e.target);"BUTTON"!==t.prop("nodeName")&&(t=t.closest(".btn-move-calendar")),a.moveCurrentIntervalView(g(t).attr("data-direction"))})},n.prototype.clickSwitchView=function(){var e=this;g(this.element).find(".monthtoweek").click(function(){e.setTimestamp(parseInt(g(this).find("span").attr("data-timestamp"))),e.setView("week"),e.init()}),g(this.element).find(".weektomonth").click(function(){e.setView("month"),e.init()}),g(this.element).find(".daytoweek").click(function(){e.setView("week"),e.init()}),g(this.element).find(".weektoday").click(function(){e.setTimestamp(g(this).closest(".calendar-events-day").attr("data-time")),e.setView("day"),e.init()})},n.prototype.keyboardSwitchView=function(){if(this.conf.enableKeyboard){var t=this;g(window).unbind("keydown").on("keydown",function(e){37===e.keyCode&&e.ctrlKey&&t.moveCurrentIntervalView("left"),39===e.keyCode&&e.ctrlKey&&t.moveCurrentIntervalView("right"),38===e.keyCode&&e.ctrlKey&&("week"===t.getView()&&(t.setView("month"),t.init()),"day"===t.getView()&&(t.setView("week"),t.init())),40===e.keyCode&&e.ctrlKey&&("week"===t.getView()&&(t.setView("day"),t.init()),"month"===t.getView()&&(t.setView("week"),t.init()))})}},n.prototype.moveCurrentIntervalView=function(e){var t;"day"===this.getView()&&(t="days"),"week"===this.getView()&&(t="week"),"month"===this.getView()&&(t="month"),"left"===e&&(this.conf.unixTimestamp=parseInt(moment.unix(this.conf.unixTimestamp).subtract(1,t).format("X"))),"right"===e&&(this.conf.unixTimestamp=parseInt(moment.unix(this.conf.unixTimestamp).add(1,t).format("X"))),this.init()},n.prototype.mobileQuery=function(){return g(window).width()<this.conf.defaultView.smallScreenThreshold?"mobile":"desktop"},n.prototype.hexToRgb=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,a,n){return t+t+a+a+n+n});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},n.prototype.calculateCurrentInterval=function(){var e=this.getViewDays();this.fromTimestamp=parseInt(moment.unix(e[0]).startOf("day").format("X")),this.toTimestamp=parseInt(moment.unix(e[e.length-1]).endOf("day").format("X"))},n.prototype.getCategories=function(e,t,a){for(var n,o=[],i=e.length,r=parseInt(this.fromTimestamp),s=parseInt(this.toTimestamp),d=0;d<i;d++)n=e[d],parseInt(n[t])>=r&&parseInt(n[a])<=s&&o.push(n.category);return this.miscUniqueArray(o)},n.prototype.getCategoryColor=function(e,t,a,n){for(var o,i,r=t.length;r--;)if(t[r].category===e)return t[r].color;for(r=0;r<a.length;r++){for(o=!1,i=t.length;i--;)t[i].color===a[r]&&(o=!0);if(!o)return t.push({category:e,color:a[r]}),a[r]}return n},n.prototype.getEventsCategories=function(){return this.getCategories(this.events,"start","end")},n.prototype.determineEventsCategories=function(){var e=this.getEventsCategories();this.eventCategoryColor=0<this.userEventCategoryColor.length?this.userEventCategoryColor:[];for(var t=e.length;t--;)this.getEventCategoryColor(e[t])},n.prototype.getEventCategoryColor=function(e){return this.getCategoryColor(e,this.eventCategoryColor,this.conf.colors.events,"#000000")},n.prototype.getEventCategoriesColors=function(){return this.eventCategoryColor},n.prototype.setEventCategoriesColors=function(e){this.userEventCategoryColor=e},n.prototype.getDaynotesCategories=function(){return this.getCategories(this.daynotes,"time","time")},n.prototype.determineDaynotesCategories=function(){var e=this.getDaynotesCategories();this.daynoteCategoryColor=0<this.userDaynoteCategoryColor.length?this.userDaynoteCategoryColor:[];for(var t=e.length;t--;)this.getDaynoteCategoryColor(e[t])},n.prototype.getDaynoteCategoryColor=function(e){return this.getCategoryColor(e,this.daynoteCategoryColor,this.conf.colors.daynotes,"#FEFEFE")},n.prototype.getDaynoteCategoriesColors=function(){return this.daynoteCategoryColor},n.prototype.setDaynoteCategoriesColors=function(e){this.userDaynoteCategoryColor=e},n.prototype.getEventColors=function(){return this.conf.colors.events},n.prototype.setEventColors=function(e){this.conf.colors.events=this.miscUniqueArray(e),this.conf.colors.random&&this.conf.colors.events.sort(function(){return.5-Math.random()})},n.prototype.getDaynoteColors=function(){return this.conf.colors.daynotes},n.prototype.setDaynoteColors=function(e){this.conf.colors.daynotes=this.miscUniqueArray(e),this.conf.colors.random&&this.conf.colors.daynotes.sort(function(){return.5-Math.random()})},n.prototype.getEvents=function(){return this.events},n.prototype.setEvents=function(e){this.events=e||[],this.events.sort(function(e,t){return e.start>t.start?1:-1})},n.prototype.addEvents=function(e){this.events=this.events.concat(e),this.events.sort(function(e,t){return e.start>t.start?1:-1})},n.prototype.getDaynotes=function(){return this.daynotes},n.prototype.setDaynotes=function(e){this.daynotes=e||[],this.daynotes.sort(function(e,t){return e.start>t.start?1:-1})},n.prototype.addDaynotes=function(e){this.daynotes=this.daynotes.concat(e),this.daynotes.sort(function(e,t){return e.start>t.start?1:-1})},n.prototype.getInitTime=function(){return this.initTime},n.prototype.getViewInterval=function(){return[this.fromTimestamp,this.toTimestamp]},n.prototype.getNextViewInterval=function(){var e={day:"d",week:"w",month:"M"};return e=e[this.getView()],[parseInt(moment.unix(this.fromTimestamp).add(1,e).format("X")),parseInt(moment.unix(this.toTimestamp).add(1,e).format("X"))]},n.prototype.getPrevViewInterval=function(){var e={day:"d",week:"w",month:"M"};return e=e[this.getView()],[parseInt(moment.unix(this.fromTimestamp).subtract(1,e).format("X")),parseInt(moment.unix(this.toTimestamp).subtract(1,e).format("X"))]},n.prototype.getTimestamp=function(){return this.conf.unixTimestamp},n.prototype.setTimestamp=function(e){this.conf.unixTimestamp=parseInt(e)},n.prototype.getView=function(){return this.conf.view},n.prototype.setView=function(e){"day"!=e&&"week"!=e&&"month"!=e||(this.conf.view=e)},n.prototype.miscUniqueArray=function(e){e=e.concat();for(var t=0;t<e.length;++t)for(var a=t+1;a<e.length;++a)e[t]===e[a]&&e.splice(a--,1);return e},n.prototype.miscUcfirstString=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};var e,o=[];jQuery.extend(jQuery.fn,{Calendar:function(e){var t=new n(g(this),void 0===e?{}:e);return o.push(t),t}});var t;window.addEventListener("orientationchange",function(){clearTimeout(e),e=setTimeout(function(){o.forEach(function(e){e.init()})},500)});window.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(function(){o.forEach(function(e){"desktop"===e.mobileQuery()&&e.init()})},500)})});